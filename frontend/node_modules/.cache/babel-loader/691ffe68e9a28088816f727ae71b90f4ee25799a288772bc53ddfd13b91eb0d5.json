{"ast":null,"code":"// Service for handling file uploads and API communication\n\nconst API_BASE_URL = 'https://td86a455og.execute-api.us-east-1.amazonaws.com/prod/';\nconst AWS_REGION = process.env.REACT_APP_AWS_REGION;\nconst API_KEY = process.env.REACT_APP_AWS_API_KEY;\nexport const uploadService = {\n  // Upload file to S3 using presigned URL\n  async uploadFile(file, onProgress, onStatusChange) {\n    console.log(`Starting upload for file: ${file.name} (${file.size} bytes)`);\n    try {\n      // Get presigned URL\n      onProgress === null || onProgress === void 0 ? void 0 : onProgress(10);\n      const urlResponse = await fetch(`${API_BASE_URL}generate-url`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          fileName: file.name,\n          fileType: file.type\n        })\n      });\n      if (!urlResponse.ok) {\n        throw new Error(`Failed to get presigned URL with status: ${urlResponse.status}`);\n      }\n      const {\n        uploadUrl\n      } = await urlResponse.json();\n      onProgress === null || onProgress === void 0 ? void 0 : onProgress(30);\n\n      // Upload file to S3 with progress simulation\n      return new Promise((resolve, reject) => {\n        const xhr = new XMLHttpRequest();\n        xhr.upload.addEventListener('progress', e => {\n          if (e.lengthComputable) {\n            const progress = Math.round(30 + e.loaded / e.total * 70);\n            onProgress === null || onProgress === void 0 ? void 0 : onProgress(progress);\n          }\n        });\n        xhr.addEventListener('load', async () => {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            onProgress === null || onProgress === void 0 ? void 0 : onProgress(100);\n\n            // Wait 3 minutes then get results\n            setTimeout(async () => {\n              try {\n                var _this$statusChangeCal;\n                const results = await this.getResults(file.name);\n                onStatusChange === null || onStatusChange === void 0 ? void 0 : onStatusChange('completed', results);\n                (_this$statusChangeCal = this.statusChangeCallback) === null || _this$statusChangeCal === void 0 ? void 0 : _this$statusChangeCal.call(this, 'completed', results);\n              } catch (error) {\n                var _this$statusChangeCal2;\n                console.error('Error getting results after upload:', error);\n                onStatusChange === null || onStatusChange === void 0 ? void 0 : onStatusChange('failed', null);\n                (_this$statusChangeCal2 = this.statusChangeCallback) === null || _this$statusChangeCal2 === void 0 ? void 0 : _this$statusChangeCal2.call(this, 'failed', null);\n              }\n            }, 180000);\n            resolve({\n              success: true,\n              fileName: file.name,\n              fileSize: file.size\n            });\n          } else {\n            reject(new Error(`Failed to upload file with status: ${xhr.status}`));\n          }\n        });\n        xhr.addEventListener('error', () => {\n          reject(new Error('Upload failed'));\n        });\n        xhr.open('PUT', uploadUrl);\n        xhr.send(file);\n      });\n    } catch (error) {\n      console.error('Upload error:', error.message);\n      throw error;\n    }\n  },\n  // Get results from API\n  async getResults(originalFileName) {\n    const fileName = `aggregated_${originalFileName.replace('.wav', '')}.json`;\n    console.log(`Fetching results for fileName: ${fileName}`);\n    try {\n      const response = await fetch(`${API_BASE_URL}get-results?fileName=${encodeURIComponent(fileName)}`);\n      if (!response.ok) {\n        throw new Error(`Failed to get results. Status: ${response.status}`);\n      }\n      const results = await response.json();\n      console.log('Results retrieved successfully:', results);\n      return results;\n    } catch (error) {\n      console.error('Error fetching results:', error.message);\n      throw error;\n    }\n  },\n  // Set status change callback\n  setStatusChangeCallback(callback) {\n    this.statusChangeCallback = callback;\n  },\n  // Get analysis results\n  async getAnalysisResults(fileId) {\n    console.log(`Fetching analysis results for fileId: ${fileId}`);\n    try {\n      const response = await fetch(`${API_BASE_URL}/analysis/${fileId}`, {\n        headers: {\n          'x-api-key': API_KEY\n        }\n      });\n      if (!response.ok) {\n        console.error(`Failed to get analysis results. Status: ${response.status}`);\n        throw new Error(`Failed to get analysis results. Status: ${response.status}`);\n      }\n      const results = await response.json();\n      console.log('Analysis results retrieved successfully:', results);\n      return results;\n    } catch (error) {\n      console.error('Error fetching analysis results:', error.message);\n      throw error;\n    }\n  },\n  // Simulate upload progress (for demo purposes)\n  simulateUpload(file, onProgress) {\n    console.log(`Simulating upload for file: ${file.name} (${file.size} bytes)`);\n    return new Promise(resolve => {\n      let progress = 0;\n      const interval = setInterval(() => {\n        progress += 10;\n        console.log(`Upload progress: ${progress}%`);\n        onProgress(progress);\n        if (progress >= 100) {\n          clearInterval(interval);\n          const result = {\n            success: true,\n            fileId: Date.now().toString(),\n            fileName: file.name,\n            fileSize: file.size\n          };\n          console.log('Simulated upload complete:', result);\n          resolve(result);\n        }\n      }, 200);\n    });\n  }\n};","map":{"version":3,"names":["API_BASE_URL","AWS_REGION","process","env","REACT_APP_AWS_REGION","API_KEY","REACT_APP_AWS_API_KEY","uploadService","uploadFile","file","onProgress","onStatusChange","console","log","name","size","urlResponse","fetch","method","headers","body","JSON","stringify","fileName","fileType","type","ok","Error","status","uploadUrl","json","Promise","resolve","reject","xhr","XMLHttpRequest","upload","addEventListener","e","lengthComputable","progress","Math","round","loaded","total","setTimeout","_this$statusChangeCal","results","getResults","statusChangeCallback","call","error","_this$statusChangeCal2","success","fileSize","open","send","message","originalFileName","replace","response","encodeURIComponent","setStatusChangeCallback","callback","getAnalysisResults","fileId","simulateUpload","interval","setInterval","clearInterval","result","Date","now","toString"],"sources":["/Users/synamalhan/Desktop/CIC/boys-town/frontend/src/services/uploadService.js"],"sourcesContent":["// Service for handling file uploads and API communication\n\nconst API_BASE_URL = 'https://td86a455og.execute-api.us-east-1.amazonaws.com/prod/';\nconst AWS_REGION = process.env.REACT_APP_AWS_REGION;\nconst API_KEY = process.env.REACT_APP_AWS_API_KEY;\n\nexport const uploadService = {\n  // Upload file to S3 using presigned URL\n  async uploadFile(file, onProgress, onStatusChange) {\n    console.log(`Starting upload for file: ${file.name} (${file.size} bytes)`);\n    \n    try {\n      // Get presigned URL\n      onProgress?.(10);\n      const urlResponse = await fetch(`${API_BASE_URL}generate-url`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          fileName: file.name,\n          fileType: file.type\n        })\n      });\n      \n      if (!urlResponse.ok) {\n        throw new Error(`Failed to get presigned URL with status: ${urlResponse.status}`);\n      }\n      \n      const { uploadUrl } = await urlResponse.json();\n      onProgress?.(30);\n      \n      // Upload file to S3 with progress simulation\n      return new Promise((resolve, reject) => {\n        const xhr = new XMLHttpRequest();\n        \n        xhr.upload.addEventListener('progress', (e) => {\n          if (e.lengthComputable) {\n            const progress = Math.round(30 + (e.loaded / e.total) * 70);\n            onProgress?.(progress);\n          }\n        });\n        \n        xhr.addEventListener('load', async () => {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            onProgress?.(100);\n            \n            // Wait 3 minutes then get results\n            setTimeout(async () => {\n              try {\n                const results = await this.getResults(file.name);\n                onStatusChange?.('completed', results);\n                this.statusChangeCallback?.('completed', results);\n              } catch (error) {\n                console.error('Error getting results after upload:', error);\n                onStatusChange?.('failed', null);\n                this.statusChangeCallback?.('failed', null);\n              }\n            }, 180000);\n            \n            resolve({ success: true, fileName: file.name, fileSize: file.size });\n          } else {\n            reject(new Error(`Failed to upload file with status: ${xhr.status}`));\n          }\n        });\n        \n        xhr.addEventListener('error', () => {\n          reject(new Error('Upload failed'));\n        });\n        \n        xhr.open('PUT', uploadUrl);\n        xhr.send(file);\n      });\n    } catch (error) {\n      console.error('Upload error:', error.message);\n      throw error;\n    }\n  },\n\n  // Get results from API\n  async getResults(originalFileName) {\n    const fileName = `aggregated_${originalFileName.replace('.wav', '')}.json`;\n    console.log(`Fetching results for fileName: ${fileName}`);\n    \n    try {\n      const response = await fetch(`${API_BASE_URL}get-results?fileName=${encodeURIComponent(fileName)}`);\n      \n      if (!response.ok) {\n        throw new Error(`Failed to get results. Status: ${response.status}`);\n      }\n      \n      const results = await response.json();\n      console.log('Results retrieved successfully:', results);\n      return results;\n    } catch (error) {\n      console.error('Error fetching results:', error.message);\n      throw error;\n    }\n  },\n\n  // Set status change callback\n  setStatusChangeCallback(callback) {\n    this.statusChangeCallback = callback;\n  },\n\n  // Get analysis results\n  async getAnalysisResults(fileId) {\n    console.log(`Fetching analysis results for fileId: ${fileId}`);\n    try {\n      const response = await fetch(`${API_BASE_URL}/analysis/${fileId}`, {\n        headers: {\n          'x-api-key': API_KEY\n        }\n      });\n      \n      if (!response.ok) {\n        console.error(`Failed to get analysis results. Status: ${response.status}`);\n        throw new Error(`Failed to get analysis results. Status: ${response.status}`);\n      }\n      \n      const results = await response.json();\n      console.log('Analysis results retrieved successfully:', results);\n      return results;\n    } catch (error) {\n      console.error('Error fetching analysis results:', error.message);\n      throw error;\n    }\n  },\n\n  // Simulate upload progress (for demo purposes)\n  simulateUpload(file, onProgress) {\n    console.log(`Simulating upload for file: ${file.name} (${file.size} bytes)`);\n    return new Promise((resolve) => {\n      let progress = 0;\n      const interval = setInterval(() => {\n        progress += 10;\n        console.log(`Upload progress: ${progress}%`);\n        onProgress(progress);\n        \n        if (progress >= 100) {\n          clearInterval(interval);\n          const result = {\n            success: true,\n            fileId: Date.now().toString(),\n            fileName: file.name,\n            fileSize: file.size\n          };\n          console.log('Simulated upload complete:', result);\n          resolve(result);\n        }\n      }, 200);\n    });\n  }\n};"],"mappings":"AAAA;;AAEA,MAAMA,YAAY,GAAG,8DAA8D;AACnF,MAAMC,UAAU,GAAGC,OAAO,CAACC,GAAG,CAACC,oBAAoB;AACnD,MAAMC,OAAO,GAAGH,OAAO,CAACC,GAAG,CAACG,qBAAqB;AAEjD,OAAO,MAAMC,aAAa,GAAG;EAC3B;EACA,MAAMC,UAAUA,CAACC,IAAI,EAAEC,UAAU,EAAEC,cAAc,EAAE;IACjDC,OAAO,CAACC,GAAG,CAAC,6BAA6BJ,IAAI,CAACK,IAAI,KAAKL,IAAI,CAACM,IAAI,SAAS,CAAC;IAE1E,IAAI;MACF;MACAL,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAG,EAAE,CAAC;MAChB,MAAMM,WAAW,GAAG,MAAMC,KAAK,CAAC,GAAGjB,YAAY,cAAc,EAAE;QAC7DkB,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UACP,cAAc,EAAE;QAClB,CAAC;QACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UACnBC,QAAQ,EAAEd,IAAI,CAACK,IAAI;UACnBU,QAAQ,EAAEf,IAAI,CAACgB;QACjB,CAAC;MACH,CAAC,CAAC;MAEF,IAAI,CAACT,WAAW,CAACU,EAAE,EAAE;QACnB,MAAM,IAAIC,KAAK,CAAC,4CAA4CX,WAAW,CAACY,MAAM,EAAE,CAAC;MACnF;MAEA,MAAM;QAAEC;MAAU,CAAC,GAAG,MAAMb,WAAW,CAACc,IAAI,CAAC,CAAC;MAC9CpB,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAG,EAAE,CAAC;;MAEhB;MACA,OAAO,IAAIqB,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QACtC,MAAMC,GAAG,GAAG,IAAIC,cAAc,CAAC,CAAC;QAEhCD,GAAG,CAACE,MAAM,CAACC,gBAAgB,CAAC,UAAU,EAAGC,CAAC,IAAK;UAC7C,IAAIA,CAAC,CAACC,gBAAgB,EAAE;YACtB,MAAMC,QAAQ,GAAGC,IAAI,CAACC,KAAK,CAAC,EAAE,GAAIJ,CAAC,CAACK,MAAM,GAAGL,CAAC,CAACM,KAAK,GAAI,EAAE,CAAC;YAC3DlC,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAG8B,QAAQ,CAAC;UACxB;QACF,CAAC,CAAC;QAEFN,GAAG,CAACG,gBAAgB,CAAC,MAAM,EAAE,YAAY;UACvC,IAAIH,GAAG,CAACN,MAAM,IAAI,GAAG,IAAIM,GAAG,CAACN,MAAM,GAAG,GAAG,EAAE;YACzClB,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAG,GAAG,CAAC;;YAEjB;YACAmC,UAAU,CAAC,YAAY;cACrB,IAAI;gBAAA,IAAAC,qBAAA;gBACF,MAAMC,OAAO,GAAG,MAAM,IAAI,CAACC,UAAU,CAACvC,IAAI,CAACK,IAAI,CAAC;gBAChDH,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAG,WAAW,EAAEoC,OAAO,CAAC;gBACtC,CAAAD,qBAAA,OAAI,CAACG,oBAAoB,cAAAH,qBAAA,uBAAzBA,qBAAA,CAAAI,IAAA,KAAI,EAAwB,WAAW,EAAEH,OAAO,CAAC;cACnD,CAAC,CAAC,OAAOI,KAAK,EAAE;gBAAA,IAAAC,sBAAA;gBACdxC,OAAO,CAACuC,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAAC;gBAC3DxC,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAG,QAAQ,EAAE,IAAI,CAAC;gBAChC,CAAAyC,sBAAA,OAAI,CAACH,oBAAoB,cAAAG,sBAAA,uBAAzBA,sBAAA,CAAAF,IAAA,KAAI,EAAwB,QAAQ,EAAE,IAAI,CAAC;cAC7C;YACF,CAAC,EAAE,MAAM,CAAC;YAEVlB,OAAO,CAAC;cAAEqB,OAAO,EAAE,IAAI;cAAE9B,QAAQ,EAAEd,IAAI,CAACK,IAAI;cAAEwC,QAAQ,EAAE7C,IAAI,CAACM;YAAK,CAAC,CAAC;UACtE,CAAC,MAAM;YACLkB,MAAM,CAAC,IAAIN,KAAK,CAAC,sCAAsCO,GAAG,CAACN,MAAM,EAAE,CAAC,CAAC;UACvE;QACF,CAAC,CAAC;QAEFM,GAAG,CAACG,gBAAgB,CAAC,OAAO,EAAE,MAAM;UAClCJ,MAAM,CAAC,IAAIN,KAAK,CAAC,eAAe,CAAC,CAAC;QACpC,CAAC,CAAC;QAEFO,GAAG,CAACqB,IAAI,CAAC,KAAK,EAAE1B,SAAS,CAAC;QAC1BK,GAAG,CAACsB,IAAI,CAAC/C,IAAI,CAAC;MAChB,CAAC,CAAC;IACJ,CAAC,CAAC,OAAO0C,KAAK,EAAE;MACdvC,OAAO,CAACuC,KAAK,CAAC,eAAe,EAAEA,KAAK,CAACM,OAAO,CAAC;MAC7C,MAAMN,KAAK;IACb;EACF,CAAC;EAED;EACA,MAAMH,UAAUA,CAACU,gBAAgB,EAAE;IACjC,MAAMnC,QAAQ,GAAG,cAAcmC,gBAAgB,CAACC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,OAAO;IAC1E/C,OAAO,CAACC,GAAG,CAAC,kCAAkCU,QAAQ,EAAE,CAAC;IAEzD,IAAI;MACF,MAAMqC,QAAQ,GAAG,MAAM3C,KAAK,CAAC,GAAGjB,YAAY,wBAAwB6D,kBAAkB,CAACtC,QAAQ,CAAC,EAAE,CAAC;MAEnG,IAAI,CAACqC,QAAQ,CAAClC,EAAE,EAAE;QAChB,MAAM,IAAIC,KAAK,CAAC,kCAAkCiC,QAAQ,CAAChC,MAAM,EAAE,CAAC;MACtE;MAEA,MAAMmB,OAAO,GAAG,MAAMa,QAAQ,CAAC9B,IAAI,CAAC,CAAC;MACrClB,OAAO,CAACC,GAAG,CAAC,iCAAiC,EAAEkC,OAAO,CAAC;MACvD,OAAOA,OAAO;IAChB,CAAC,CAAC,OAAOI,KAAK,EAAE;MACdvC,OAAO,CAACuC,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAACM,OAAO,CAAC;MACvD,MAAMN,KAAK;IACb;EACF,CAAC;EAED;EACAW,uBAAuBA,CAACC,QAAQ,EAAE;IAChC,IAAI,CAACd,oBAAoB,GAAGc,QAAQ;EACtC,CAAC;EAED;EACA,MAAMC,kBAAkBA,CAACC,MAAM,EAAE;IAC/BrD,OAAO,CAACC,GAAG,CAAC,yCAAyCoD,MAAM,EAAE,CAAC;IAC9D,IAAI;MACF,MAAML,QAAQ,GAAG,MAAM3C,KAAK,CAAC,GAAGjB,YAAY,aAAaiE,MAAM,EAAE,EAAE;QACjE9C,OAAO,EAAE;UACP,WAAW,EAAEd;QACf;MACF,CAAC,CAAC;MAEF,IAAI,CAACuD,QAAQ,CAAClC,EAAE,EAAE;QAChBd,OAAO,CAACuC,KAAK,CAAC,2CAA2CS,QAAQ,CAAChC,MAAM,EAAE,CAAC;QAC3E,MAAM,IAAID,KAAK,CAAC,2CAA2CiC,QAAQ,CAAChC,MAAM,EAAE,CAAC;MAC/E;MAEA,MAAMmB,OAAO,GAAG,MAAMa,QAAQ,CAAC9B,IAAI,CAAC,CAAC;MACrClB,OAAO,CAACC,GAAG,CAAC,0CAA0C,EAAEkC,OAAO,CAAC;MAChE,OAAOA,OAAO;IAChB,CAAC,CAAC,OAAOI,KAAK,EAAE;MACdvC,OAAO,CAACuC,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAACM,OAAO,CAAC;MAChE,MAAMN,KAAK;IACb;EACF,CAAC;EAED;EACAe,cAAcA,CAACzD,IAAI,EAAEC,UAAU,EAAE;IAC/BE,OAAO,CAACC,GAAG,CAAC,+BAA+BJ,IAAI,CAACK,IAAI,KAAKL,IAAI,CAACM,IAAI,SAAS,CAAC;IAC5E,OAAO,IAAIgB,OAAO,CAAEC,OAAO,IAAK;MAC9B,IAAIQ,QAAQ,GAAG,CAAC;MAChB,MAAM2B,QAAQ,GAAGC,WAAW,CAAC,MAAM;QACjC5B,QAAQ,IAAI,EAAE;QACd5B,OAAO,CAACC,GAAG,CAAC,oBAAoB2B,QAAQ,GAAG,CAAC;QAC5C9B,UAAU,CAAC8B,QAAQ,CAAC;QAEpB,IAAIA,QAAQ,IAAI,GAAG,EAAE;UACnB6B,aAAa,CAACF,QAAQ,CAAC;UACvB,MAAMG,MAAM,GAAG;YACbjB,OAAO,EAAE,IAAI;YACbY,MAAM,EAAEM,IAAI,CAACC,GAAG,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC;YAC7BlD,QAAQ,EAAEd,IAAI,CAACK,IAAI;YACnBwC,QAAQ,EAAE7C,IAAI,CAACM;UACjB,CAAC;UACDH,OAAO,CAACC,GAAG,CAAC,4BAA4B,EAAEyD,MAAM,CAAC;UACjDtC,OAAO,CAACsC,MAAM,CAAC;QACjB;MACF,CAAC,EAAE,GAAG,CAAC;IACT,CAAC,CAAC;EACJ;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}